import{u as M,s as K,j as e,a as g,x as I,w as Q,V as R,t as H,I as V,C as z,J as U,X as _}from"./index-BxsAN5hr.js";import{r as h}from"./vendor-react-wGySg1uH.js";import"./vendor-socket-TjCxX7sJ.js";import"./vendor-terminal-CyaXSNWE.js";const X=[{name:"spawn_worker",patterns:[/spawn\s+(?:a\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i,/start\s+(?:a\s+)?(?:new\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i,/create\s+(?:a\s+)?(?:new\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i,/launch\s+(?:a\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i]},{name:"stop_worker",patterns:[/stop\s+(?:the\s+)?worker(?:\s+(.+))?/i,/kill\s+(?:the\s+)?worker(?:\s+(.+))?/i,/terminate\s+(?:the\s+)?worker(?:\s+(.+))?/i,/end\s+(?:the\s+)?worker(?:\s+(.+))?/i,/stop\s+all\s+workers/i,/kill\s+all\s+workers/i]},{name:"send_message",patterns:[/send\s+(?:message\s+)?["']?(.+?)["']?\s+(?:to\s+)?(?:the\s+)?(?:worker)?(?:\s+(.+))?$/i,/tell\s+(?:the\s+)?worker(?:\s+(.+))?\s+(?:to\s+)?["']?(.+?)["']?$/i,/message\s+(?:the\s+)?worker(?:\s+(.+))?\s+(?:with\s+)?["']?(.+?)["']?$/i]},{name:"show_status",patterns:[/(?:show|display|what(?:'s|\s+is)?)\s+(?:the\s+)?status/i,/status(?:\s+(?:of|for)\s+(?:the\s+)?workers?)?/i,/how\s+(?:are|is)\s+(?:the\s+)?workers?\s+doing/i,/worker\s+status/i,/list\s+workers/i,/what\s+workers\s+(?:are\s+)?running/i]}];function O(s){const r=s.trim().toLowerCase();for(const n of X)for(const o of n.patterns){const u=r.match(o);if(u)return{command:n.name,matches:u.slice(1).filter(Boolean),raw:s}}return null}function A(s,r){if(!r)return null;const n=r.toLowerCase().trim();let o=s.find(u=>{var d;return u.id===n||((d=u.label)==null?void 0:d.toLowerCase())===n});return o||(o=s.find(u=>{var d,b;return((d=u.label)==null?void 0:d.toLowerCase().includes(n))||((b=u.projectPath)==null?void 0:b.toLowerCase().includes(n))})),o}function Y(s,r){if(!r)return null;const n=r.toLowerCase().trim();let o=s.find(u=>{var d;return((d=u.name)==null?void 0:d.toLowerCase())===n});return o||(o=s.find(u=>{var d;return(d=u.name)==null?void 0:d.toLowerCase().includes(n)})),o}function B(){const{workers:s,projects:r,spawnWorker:n,killWorker:o,sendInput:u,focusedWorker:d,addToast:b}=M(),w=h.useCallback(async m=>{if(!m)return{success:!1,message:"Command not recognized",spoken:"I didn't understand that command. Try spawn worker, stop worker, send message, or show status."};const{command:N,matches:p}=m;switch(N){case"spawn_worker":{const l=p[0];if(l){const i=Y(r,l);return i?(await n(i.path,`${i.name} Worker`),{success:!0,message:`Spawning worker for ${i.name}`,spoken:`Spawning a new worker for ${i.name}.`}):{success:!1,message:`Project "${l}" not found`,spoken:`I couldn't find a project matching "${l}". Try saying the exact project name.`}}else if(r.length>0){const i=r[0];return await n(i.path,`${i.name} Worker`),{success:!0,message:`Spawning worker for ${i.name}`,spoken:`Spawning a new worker for ${i.name}.`}}else return{success:!1,message:"No projects available",spoken:"No projects are available to spawn a worker."}}case"stop_worker":{const l=p[0];if(m.raw.toLowerCase().includes("all")){const t=s.filter(c=>c.status==="running");return t.length===0?{success:!1,message:"No workers running",spoken:"There are no workers running to stop."}:(t.forEach(c=>o(c.id)),{success:!0,message:`Stopping ${t.length} workers`,spoken:`Stopping all ${t.length} workers.`})}if(l){const t=A(s,l);return t?(o(t.id),{success:!0,message:`Stopping worker ${t.label||t.id}`,spoken:`Stopping worker ${t.label||"unnamed"}.`}):{success:!1,message:`Worker "${l}" not found`,spoken:`I couldn't find a worker matching "${l}".`}}else if(d){const t=s.find(c=>c.id===d);return o(d),{success:!0,message:"Stopping focused worker",spoken:`Stopping the focused worker ${(t==null?void 0:t.label)||""}.`}}else return s.length===1?(o(s[0].id),{success:!0,message:`Stopping worker ${s[0].label||s[0].id}`,spoken:"Stopping the only running worker."}):{success:!1,message:"Please specify which worker to stop",spoken:"Please specify which worker to stop. You can say stop worker followed by the worker name, or say stop all workers."}}case"send_message":{let l=p[0],i=p[1];if((m.raw.toLowerCase().startsWith("tell")||m.raw.toLowerCase().startsWith("message"))&&(i=p[0],l=p[1]),!l)return{success:!1,message:"No message specified",spoken:"Please specify a message to send."};let t;if(i){const f=A(s,i);if(f)t=f.id;else return{success:!1,message:`Worker "${i}" not found`,spoken:`I couldn't find a worker matching "${i}".`}}else if(d)t=d;else if(s.length===1)t=s[0].id;else return{success:!1,message:"Please specify which worker",spoken:"Please specify which worker to send the message to."};u(t,l+`
`);const c=s.find(f=>f.id===t);return{success:!0,message:`Sent message to ${(c==null?void 0:c.label)||"worker"}`,spoken:`Message sent to ${(c==null?void 0:c.label)||"the worker"}.`}}case"show_status":{const l=s.filter(k=>k.status==="running"),i=s.filter(k=>k.status!=="running");if(s.length===0)return{success:!0,message:"No workers",spoken:"No workers are currently registered."};const t=[];l.length>0&&t.push(`${l.length} running`),i.length>0&&t.push(`${i.length} stopped`);const c=l.map(k=>k.label||"unnamed").join(", "),f=l.length>0?`You have ${l.length} worker${l.length>1?"s":""} running: ${c}.`:"No workers are currently running.";return{success:!0,message:`Workers: ${t.join(", ")}`,spoken:f}}default:return{success:!1,message:"Unknown command",spoken:"I didn't recognize that command."}}},[s,r,n,o,u,d]),j=h.useCallback(async m=>{const N=O(m),p=await w(N);return b({type:p.success?"success":"warning",title:p.success?"Command Executed":"Command Failed",message:p.message,duration:3e3}),p},[w,b]);return{parseCommand:O,executeCommand:w,processTranscript:j,availableCommands:[{name:"spawn worker",description:"Start a new worker",example:"spawn worker on strategos"},{name:"stop worker",description:"Stop a running worker",example:"stop worker"},{name:"send message",description:"Send text to a worker",example:"send hello to the worker"},{name:"show status",description:"Show worker status",example:"show status"}]}}function Z({className:s}){const{isListening:r,isSpeaking:n,transcript:o,sttSupported:u,ttsSupported:d,startListening:b,stopListening:w,clearTranscript:j,speak:m,stopSpeaking:N}=K(),{processTranscript:p,availableCommands:l}=B(),[i,t]=h.useState(!1),[c,f]=h.useState(!1),[k,P]=h.useState(!1),[x,D]=h.useState(!0),[v,S]=h.useState(null),[$,W]=h.useState(!1),C=h.useCallback(async()=>{if(!o.trim())return;W(!0);const a=await p(o);S(a),x&&a.spoken&&await m(a.spoken),j(),W(!1)},[o,p,x,m,j]),L=h.useCallback(()=>{n&&N(),r?(w(),C()):(t(!0),j(),S(null),b())},[r,n,N,w,b,C,j]);if(h.useEffect(()=>{if(!r||!o)return;const a=setTimeout(()=>{o.trim()&&(w(),C())},2e3);return()=>clearTimeout(a)},[o,r,w,C]),h.useEffect(()=>{const a=y=>{y.ctrlKey&&y.shiftKey&&y.key==="V"&&(y.preventDefault(),L())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[L]),!u)return null;const T=()=>$?"bg-amber-500":n?"bg-blue-500":r?"bg-red-500":"bg-thea-gold/50";return i?e.jsxs("div",{className:g("relative",s),children:[e.jsx("div",{className:g("bg-black/80 border border-thea-gold-dark/30 backdrop-blur-sm transition-all",c?"rounded-t-lg":"rounded-lg"),children:e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsxs("button",{onClick:L,disabled:$,className:g("relative p-2.5 rounded-full transition-all",r?"bg-red-500/20 text-red-400 ring-2 ring-red-500/50 animate-pulse":n?"bg-blue-500/20 text-blue-400 ring-2 ring-blue-500/50":"bg-thea-gold/10 text-thea-gold hover:bg-thea-gold/20","disabled:opacity-50 disabled:cursor-not-allowed"),title:r?"Stop listening":"Start listening (Ctrl+Shift+V)","aria-label":r?"Stop listening":"Start voice input",children:[r?e.jsx(Q,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{className:g("absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full",T())})]}),e.jsx("div",{className:"flex-1 min-w-0",children:r&&o?e.jsx("p",{className:"text-sm text-thea-gold truncate animate-pulse",children:o}):r?e.jsx("p",{className:"text-sm text-red-400 animate-pulse",children:"Listening..."}):n?e.jsx("p",{className:"text-sm text-blue-400",children:"Speaking..."}):$?e.jsx("p",{className:"text-sm text-amber-400",children:"Processing..."}):v?e.jsx("p",{className:g("text-sm truncate",v.success?"text-green-400":"text-amber-400"),children:v.message}):e.jsx("p",{className:"text-xs text-thea-gold-dark/70",children:"Voice commands ready"})}),d&&e.jsx("button",{onClick:()=>D(!x),className:g("p-1.5 rounded transition-colors",x?"text-thea-gold-bright":"text-thea-gold-dark"),title:x?"Disable voice feedback":"Enable voice feedback",children:x?e.jsx(R,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P(!k),className:g("p-1.5 rounded transition-colors",k?"text-thea-gold-bright":"text-thea-gold-dark hover:text-thea-gold"),title:"Show available commands","aria-label":"Show available voice commands","aria-expanded":k,children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>f(!c),className:"p-1.5 rounded text-thea-gold-dark hover:text-thea-gold transition-colors",title:c?"Collapse":"Expand","aria-label":c?"Collapse voice control":"Expand voice control","aria-expanded":c,children:c?e.jsx(z,{className:"w-4 h-4"}):e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{r&&w(),t(!1),f(!1)},className:"p-1.5 rounded text-thea-gold-dark hover:text-red-400 transition-colors",title:"Close voice control","aria-label":"Close voice control",children:e.jsx(_,{className:"w-4 h-4"})})]})}),c&&e.jsx("div",{className:"bg-black/90 border border-t-0 border-thea-gold-dark/30 rounded-b-lg p-3 backdrop-blur-sm",children:k?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-rajdhani font-semibold text-thea-gold uppercase tracking-wider",children:"Voice Commands"}),e.jsx("button",{onClick:()=>P(!1),className:"text-thea-gold-dark hover:text-thea-gold","aria-label":"Close help",children:e.jsx(_,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"space-y-1.5",children:l.map(a=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-thea-gold font-mono",children:a.name}),e.jsxs("span",{className:"text-thea-gold-dark/70 ml-2",children:["- ",a.description]}),e.jsxs("div",{className:"text-thea-gold-dark/50 ml-2 italic",children:['"',a.example,'"']})]},a.name))}),e.jsx("div",{className:"mt-3 pt-2 border-t border-thea-gold-dark/20",children:e.jsxs("p",{className:"text-xxs text-thea-gold-dark/50",children:["Keyboard shortcut: ",e.jsx("kbd",{className:"px-1 py-0.5 bg-black/50 rounded text-thea-gold-dark",children:"Ctrl+Shift+V"})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(E,{label:"Status",onClick:()=>{p("show status").then(a=>{S(a),x&&a.spoken&&m(a.spoken)})}}),e.jsx(E,{label:"Spawn Worker",onClick:()=>{p("spawn worker").then(a=>{S(a),x&&a.spoken&&m(a.spoken)})}}),e.jsx(E,{label:"Stop All",onClick:()=>{p("stop all workers").then(a=>{S(a),x&&a.spoken&&m(a.spoken)})},variant:"danger"})]}),v&&e.jsx("div",{className:g("p-2 rounded text-xs",v.success?"bg-green-500/10 border border-green-500/20 text-green-400":"bg-amber-500/10 border border-amber-500/20 text-amber-400"),children:v.spoken}),e.jsxs("p",{className:"text-xxs text-thea-gold-dark/50 text-center",children:["Click ",e.jsx(V,{className:"w-3 h-3 inline"})," for all commands"]})]})})]}):e.jsx("div",{className:g("relative",s),children:e.jsxs("button",{onClick:()=>t(!0),className:"p-2.5 rounded-full bg-black/80 border border-thea-gold-dark/30 backdrop-blur-sm text-thea-gold hover:bg-thea-gold/10 hover:border-thea-gold/50 transition-all shadow-lg",title:"Open voice control (Ctrl+Shift+V)","aria-label":"Open voice control",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{className:g("absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full",T())})]})})}function E({label:s,onClick:r,variant:n="default"}){return e.jsx("button",{onClick:r,className:g("px-2 py-1 text-xs font-rajdhani font-semibold rounded border transition-colors",n==="danger"?"border-red-500/30 text-red-400 hover:bg-red-500/10":"border-thea-gold-dark/30 text-thea-gold-dark hover:text-thea-gold hover:border-thea-gold/30 hover:bg-thea-gold/5"),children:s})}export{Z as VoiceControl};
