import{c as I,j as e,F as ve,L as ue,a as u,C as G,b as Se,d as fe,X as Q,u as U,e as M,P as se,R as ae,f as q,A as Ce,U as Pe,g as Fe,h as te,S as be,i as De,k as Te,l as je,H as Ee,m as Le,n as Ae,p as Re,o as $e,M as Oe,q as Me,r as Ie}from"./index-UNso8H13.js";import{r as l}from"./vendor-react-wGySg1uH.js";import{S as We}from"./server-CM8MRTNK.js";import{P as ze}from"./play-circle-CY6B-SSx.js";import{T as _e}from"./tag-B54el_3V.js";import"./vendor-socket-TjCxX7sJ.js";import"./vendor-terminal-CyaXSNWE.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=I("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=I("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=I("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=I("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=I("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=I("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=I("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=I("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),Ue={crown:Be,brain:He,"layout-grid":ue,server:We,flask:ve,folder:J};function Ze({project:t,isSelected:g,onSelect:w,editMode:o,onDragStart:b,onDragOver:f,onDrop:i,isDragging:C}){var F,P,R;const{spawnWorker:m}=U(),[j,y]=l.useState(!1),[N,k]=l.useState(!1),S=l.useRef(null);(F=t.workers)!=null&&F.length;const n=((P=t.workers)==null?void 0:P.filter(p=>p.status==="running").length)||0,x=async p=>{k(!1),y(!0);try{const a=p?`${p}: ${t.name}`:`${t.name} Worker`;await m(t.path,a)}finally{setTimeout(()=>y(!1),500)}},d=t.path?t.path.split("/").pop():"";return e.jsxs("div",{"data-testid":`project-card-${t.name}`,draggable:o,onDragStart:p=>o&&b(p,t),onDragOver:p=>o&&f(p),onDrop:p=>o&&i(p,t),onClick:()=>!o&&w(t.name),className:u("group flex items-center justify-between py-2.5 px-3 ml-6 border-l border-thea-gold-dark/30","transition-all",!o&&"hover:bg-thea-gold/5 hover:border-thea-gold/50 cursor-pointer",o&&"hover:bg-thea-gold/10 cursor-grab active:cursor-grabbing",g&&!o&&"bg-thea-gold/10 border-thea-gold",C&&"opacity-50 bg-thea-gold/20"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[o&&e.jsx(qe,{className:"w-3.5 h-3.5 text-thea-gold-dark flex-shrink-0"}),e.jsx("span",{className:u("font-rajdhani text-sm truncate",g&&!o?"text-thea-gold-bright":"text-white/80 group-hover:text-white"),children:t.name}),d&&d!==t.name&&!o&&e.jsx("span",{className:"text-xxs text-thea-gold-dark/50 font-mono truncate hidden sm:inline",children:d}),n>0&&!o&&e.jsxs("span",{className:"flex items-center gap-1.5 text-xxs text-thea-gold font-mono flex-shrink-0",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-status-success animate-pulse"}),n]}),((R=t.tags)==null?void 0:R.length)>0&&!o&&e.jsx("div",{className:"hidden sm:flex gap-1 flex-shrink-0",children:t.tags.slice(0,2).map(p=>e.jsx("span",{className:"text-xxxs px-1.5 py-0.5 bg-thea-gold/10 text-thea-gold-dark border border-thea-gold-dark/30 font-mono uppercase",children:p},p))})]}),t.description&&!o&&e.jsx("p",{className:"text-xxs text-thea-gold-dark/60 font-rajdhani truncate mt-0.5 max-w-[280px]",children:t.description})]}),!o&&e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{ref:S,"data-testid":`spawn-worker-${t.name}`,onClick:p=>{p.stopPropagation(),j||k(!N)},disabled:j,className:u("opacity-30 group-hover:opacity-100 transition-opacity","p-1.5 hover:bg-thea-gold/20 border border-transparent hover:border-thea-gold/50","flex items-center gap-0.5",(j||N)&&"opacity-100"),children:j?e.jsx(M,{className:"w-3.5 h-3.5 text-status-success animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-3.5 h-3.5 text-thea-gold"}),e.jsx(G,{className:u("w-2.5 h-2.5 text-thea-gold transition-transform",N&&"rotate-180")})]})}),e.jsx(ae,{isOpen:N,onClose:()=>k(!1),onSelect:x,triggerRef:S,position:"below"})]})]})}function Ke({folder:t,selectedProject:g,onSelectProject:w,editMode:o,onFolderLabelChange:b,onProjectDragStart:f,onProjectDragOver:i,onProjectDrop:C,onFolderDrop:m,draggingProject:j}){const[y,N]=l.useState(()=>t.id!=="_uncategorized"),[k,S]=l.useState(!1),[n,x]=l.useState(t.label),d=l.useRef(null),F=Ue[t.icon]||J,P=t.projects.reduce((h,A)=>{var W;return h+(((W=A.workers)==null?void 0:W.filter(H=>H.status==="running").length)||0)},0),R=h=>{h.stopPropagation(),x(t.label),S(!0),setTimeout(()=>{var A;return(A=d.current)==null?void 0:A.select()},0)},p=()=>{n.trim()&&n!==t.label&&b(t.id,n.trim()),S(!1)},a=()=>{x(t.label),S(!1)},v=h=>{h.key==="Enter"&&p(),h.key==="Escape"&&a()},L=h=>{j&&(h.preventDefault(),h.currentTarget.classList.add("bg-thea-gold/10"))},$=h=>{h.currentTarget.classList.remove("bg-thea-gold/10")},_=h=>{h.currentTarget.classList.remove("bg-thea-gold/10"),j&&m(t.id)};return e.jsxs("div",{className:"mb-1",onDragOver:L,onDragLeave:$,onDrop:_,children:[e.jsxs("div",{onClick:()=>!k&&N(!y),className:u("w-full flex items-center gap-2 py-2.5 px-3","hover:bg-thea-gold/5 transition-all group cursor-pointer"),children:[y?e.jsx(G,{className:"w-4 h-4 text-thea-gold-dark"}):e.jsx(Se,{className:"w-4 h-4 text-thea-gold-dark"}),e.jsx(F,{className:"w-4 h-4 flex-shrink-0",style:{color:t.color}}),k?e.jsxs("div",{className:"flex items-center gap-1 flex-1",onClick:h=>h.stopPropagation(),children:[e.jsx("input",{ref:d,type:"text",value:n,onChange:h=>x(h.target.value),onKeyDown:v,onBlur:p,className:"flex-1 bg-black/50 border border-thea-gold px-2 py-0.5 text-xs font-orbitron uppercase tracking-wider text-thea-gold-bright outline-none","aria-label":"Rename folder",autoFocus:!0}),e.jsx("button",{onClick:p,className:"p-1 hover:bg-thea-gold/20",children:e.jsx(fe,{className:"w-3.5 h-3.5 text-status-success"})}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-thea-gold/20",children:e.jsx(Q,{className:"w-3.5 h-3.5 text-thea-maroon-light"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-orbitron text-xs uppercase tracking-wider text-thea-gold-bright flex-1 text-left",children:t.label}),o&&t.id!=="_uncategorized"&&e.jsx("button",{onClick:R,className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-thea-gold/20 transition-opacity",children:e.jsx(ke,{className:"w-3 h-3 text-thea-gold-dark"})})]}),e.jsx("span",{className:"text-xxs font-mono text-thea-gold-dark",children:t.projects.length}),P>0&&e.jsxs("span",{className:"flex items-center gap-1 text-xxs text-status-success font-mono",children:[e.jsx(re,{className:"w-2.5 h-2.5 animate-pulse"}),P]})]}),y&&e.jsx("div",{className:"pb-1",children:t.projects.length===0?e.jsx("div",{className:"py-2 px-3 ml-6 border-l border-thea-gold-dark/20 text-thea-gold-dark/50 text-xs italic",children:"Drop projects here"}):t.projects.map(h=>e.jsx(Ze,{project:h,isSelected:g===h.name,onSelect:w,editMode:o,onDragStart:f,onDragOver:i,onDrop:C,isDragging:(j==null?void 0:j.name)===h.name},h.name))})]})}function Qe({tree:t,selectedProject:g,onSelectProject:w,editMode:o,onConfigChange:b}){const[f,i]=l.useState(null),[C,m]=l.useState(null);if(!t||t.length===0)return e.jsx("div",{className:"text-center py-8 text-thea-gold-dark/50 text-sm",children:"No projects found"});const j=(n,x)=>{b&&b({type:"renameFolder",folderId:n,newLabel:x})},y=(n,x)=>{i(x),m(x.folder),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",x.name)},N=n=>{n.preventDefault()},k=(n,x)=>{n.preventDefault(),i(null),m(null)},S=n=>{f&&C!==n&&b&&b({type:"moveProject",projectName:f.name,fromFolder:C,toFolder:n}),i(null),m(null)};return e.jsx("div",{className:"divide-y divide-thea-gold-dark/20",onDragEnd:()=>{i(null),m(null)},children:t.map(n=>e.jsx(Ke,{folder:n,selectedProject:g,onSelectProject:w,editMode:o,onFolderLabelChange:j,onProjectDragStart:y,onProjectDragOver:N,onProjectDrop:k,onFolderDrop:S,draggingProject:f},n.id))})}function Je({project:t,isSelected:g,onSelect:w,folderLabel:o}){var S,n,x;const{spawnWorker:b}=U(),[f,i]=l.useState(!1),[C,m]=l.useState(!1),j=l.useRef(null),y=((S=t.workers)==null?void 0:S.length)||0,N=((n=t.workers)==null?void 0:n.filter(d=>d.status==="running").length)||0,k=async d=>{m(!1),i(!0);try{const F=d?`${d}: ${t.name}`:`${t.name} Worker`;await b(t.path,F)}finally{setTimeout(()=>i(!1),500)}};return e.jsxs("div",{"data-testid":`project-card-${t.name}`,onClick:()=>w(t.name),className:u("thea-card group cursor-pointer p-4",g&&"border-thea-gold shadow-gold-md",f&&"border-status-success shadow-[0_0_20px_rgba(78,201,176,0.4)]","clip-cyber-md"),children:[e.jsx("div",{className:u("absolute top-0 right-0 w-2.5 h-2.5 border-t-2 border-r-2 transition-all",f?"border-status-success opacity-100":"border-thea-gold-bright opacity-50 group-hover:opacity-100 animate-corner-pulse")}),f&&e.jsx("div",{className:"absolute inset-0 bg-status-success/10 flex items-center justify-center z-10 backdrop-blur-[1px]",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-black/80 border border-status-success rounded-sm",children:[e.jsx(M,{className:"w-4 h-4 text-status-success animate-spin"}),e.jsx("span",{className:"text-status-success text-xs font-mono uppercase tracking-wider",children:"Spawning Claude..."})]})}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsx("h3",{className:"font-orbitron font-bold text-thea-gold-bright uppercase tracking-wider text-sm truncate",children:t.name})}),e.jsx("p",{className:"text-xxs text-thea-gold-dark font-mono truncate max-w-[180px]",children:t.path}),t.description&&e.jsx("p",{className:"text-xxs text-thea-gold-dark/60 font-rajdhani truncate mt-1",children:t.description}),((x=t.tags)==null?void 0:x.length)>0&&e.jsx("div",{className:"flex gap-1 mt-1.5 flex-wrap",children:t.tags.slice(0,3).map(d=>e.jsx("span",{className:"text-xxxs px-1.5 py-0.5 bg-thea-gold/10 text-thea-gold-dark border border-thea-gold-dark/30 font-mono uppercase",children:d},d))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:u("thea-tag flex items-center gap-1.5",N>0?"bg-thea-gold/15 text-thea-gold border-thea-gold/40":"bg-gray-900/50 text-gray-500 border-gray-700/30"),children:[e.jsx(re,{className:u("w-3 h-3",N>0&&"animate-pulse-gold")}),N,"/",y]}),o&&e.jsxs("span",{className:"flex items-center gap-1 text-xxxs text-thea-gold-dark/50 font-mono",children:[e.jsx(J,{className:"w-2.5 h-2.5"}),o]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:j,"data-testid":`spawn-worker-${t.name}`,onClick:d=>{d.stopPropagation(),f||m(!C)},disabled:f,className:u("thea-btn flex items-center gap-1 px-3 py-1.5 text-xs",f&&"opacity-50 cursor-not-allowed"),children:[f?e.jsx(M,{className:"w-3 h-3 animate-spin"}):e.jsx(se,{className:"w-3 h-3"}),f?"Spawning...":"New",!f&&e.jsx(G,{className:u("w-3 h-3 transition-transform",C&&"rotate-180")})]}),e.jsx(ae,{isOpen:C,onClose:()=>m(!1),onSelect:k,triggerRef:j,position:"below"})]})]})]})}const ge={worker_started:{icon:ze,color:"text-status-success"},worker_stopped:{icon:be,color:"text-thea-maroon-light"},error:{icon:Te,color:"text-status-error"}};function pe({worker:t}){const{attachToWorker:g,killWorker:w}=U(),o={running:"thea-badge-running",stopped:"thea-badge-stopped",error:"thea-badge-error"};return e.jsxs("div",{className:"group flex items-center gap-3 py-2.5 px-3 hover:bg-thea-gold/5 transition-colors border-b border-thea-gold-dark/10 last:border-0",children:[e.jsx(Ee,{score:Le(t.health),size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Ae,{label:t.label,size:"sm"}),e.jsx("span",{className:"font-rajdhani text-sm text-white/90 truncate",children:Re(t.label).displayName||t.label})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:u("thea-badge text-xxxs",o[t.status]||"bg-gray-800 text-gray-400 border-gray-600"),children:t.status}),e.jsx("span",{className:"text-xxs text-thea-gold-dark font-mono",children:$e(t.createdAt)}),t.ralphStatus==="in_progress"&&t.ralphProgress!=null&&e.jsxs("span",{className:"text-xxs text-purple-400 font-mono",children:[t.ralphProgress,"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-30 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>g(t.id),className:"p-1.5 hover:bg-thea-gold/20 border border-transparent hover:border-thea-gold/50 transition-all",title:"Open terminal",children:e.jsx(Oe,{className:"w-3.5 h-3.5 text-thea-gold"})}),e.jsx("button",{onClick:()=>w(t.id),className:"p-1.5 hover:bg-red-500/20 border border-transparent hover:border-red-500/50 transition-all",title:"Kill worker",children:e.jsx(Q,{className:"w-3.5 h-3.5 text-thea-maroon-light"})})]})]})}function Xe({checkpoint:t}){const[g,w]=l.useState(!1);return e.jsxs("div",{className:"border-b border-thea-gold-dark/10 last:border-0",children:[e.jsxs("button",{onClick:()=>w(!g),className:"w-full flex items-center gap-3 py-2 px-3 hover:bg-thea-gold/5 transition-colors text-left",children:[e.jsx(te,{className:"w-3.5 h-3.5 text-thea-gold-dark/50 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-rajdhani text-white/70 truncate block",children:t.label||t.workerId}),e.jsxs("span",{className:"text-xxs text-thea-gold-dark font-mono",children:[t.diedAt?je(t.diedAt):"—",t.uptime?` · ${t.uptime}`:""]})]}),e.jsx(G,{className:u("w-3.5 h-3.5 text-thea-gold-dark transition-transform",g&&"rotate-180")})]}),g&&e.jsxs("div",{className:"px-3 pb-2 ml-6",children:[t.crashReason&&e.jsxs("p",{className:"text-xxs text-thea-maroon-light font-mono mb-1",children:["Reason: ",t.crashReason]}),t.task&&e.jsxs("p",{className:"text-xxs text-thea-gold-dark font-mono mb-1 truncate",children:["Task: ",t.task]}),t.lastOutput&&e.jsx("pre",{className:"text-xxxs text-thea-gold-dark/60 font-mono bg-black/30 p-2 max-h-24 overflow-auto whitespace-pre-wrap border border-thea-gold-dark/10",children:t.lastOutput.slice(-500)})]})]})}function Ye({project:t,onBack:g}){var p;const{workers:w,activity:o,spawnWorker:b,addToast:f}=U(),[i,C]=l.useState([]),[m,j]=l.useState(!0),[y,N]=l.useState(!1),[k,S]=l.useState(!1),n=l.useRef(null),x=l.useMemo(()=>w.filter(a=>a.project===t.name),[w,t.name]),d=l.useMemo(()=>x.filter(a=>a.status==="running"),[x]),F=l.useMemo(()=>o.filter(a=>a.project===t.name).slice(0,20),[o,t.name]);l.useEffect(()=>{let a=!1;return j(!0),q("/api/checkpoints").then(v=>{if(!v.ok)throw new Error(`HTTP ${v.status}`);return v.json()}).then(v=>{if(a)return;const L=(Array.isArray(v)?v:[]).filter($=>{var _;return $.project===t.name||((_=$.projectPath)==null?void 0:_.includes(t.name))});C(L)}).catch(()=>{}).finally(()=>{a||j(!1)}),()=>{a=!0}},[t.name]);const P=l.useCallback(async a=>{N(!1),S(!0);try{const v=a?`${a}: ${t.name}`:`${t.name} Worker`;await b(t.path,v)}finally{setTimeout(()=>S(!1),500)}},[t,b]),R=l.useMemo(()=>{let a=0;for(const $ of x)$.createdAt&&(a+=Date.now()-new Date($.createdAt).getTime());if(a<6e4)return`${Math.floor(a/1e3)}s`;if(a<36e5)return`${Math.floor(a/6e4)}m`;const v=Math.floor(a/36e5),L=Math.floor(a%36e5/6e4);return`${v}h ${L}m`},[x]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-thea-gold-dark/30 bg-black/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:g,className:"p-1.5 hover:bg-thea-gold/10 border border-thea-gold-dark/30 hover:border-thea-gold/50 transition-all",title:"Back to projects",children:e.jsx(Ce,{className:"w-4 h-4 text-thea-gold"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"font-orbitron text-sm uppercase tracking-wider text-thea-gold-bright truncate",children:t.name}),e.jsx("p",{className:"text-xxs font-mono text-thea-gold-dark truncate",children:t.path})]}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs("button",{ref:n,onClick:()=>!k&&N(!y),disabled:k,className:u("thea-btn flex items-center gap-1.5 px-3 py-1.5 text-xs",k&&"opacity-50 cursor-not-allowed"),children:[k?e.jsx(M,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(se,{className:"w-3.5 h-3.5"}),k?"Spawning...":"Spawn Worker",!k&&e.jsx(G,{className:u("w-3 h-3 transition-transform",y&&"rotate-180")})]}),e.jsx(ae,{isOpen:y,onClose:()=>N(!1),onSelect:P,triggerRef:n,position:"below"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.folderLabel&&e.jsxs("span",{className:"flex items-center gap-1 text-xxs text-thea-gold-dark font-mono",children:[e.jsx(J,{className:"w-3 h-3"}),t.folderLabel]}),(p=t.tags)==null?void 0:p.map(a=>e.jsx("span",{className:"text-xxxs px-1.5 py-0.5 bg-thea-gold/10 text-thea-gold-dark border border-thea-gold-dark/30 font-mono uppercase",children:a},a))]}),t.description&&e.jsx("p",{className:"text-xs text-thea-gold-dark/70 font-rajdhani mt-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 pt-3 border-t border-thea-gold-dark/20",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),e.jsxs("span",{className:"text-xxs font-mono text-thea-gold",children:[d.length,e.jsxs("span",{className:"text-thea-gold-dark",children:["/",x.length," workers"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),e.jsxs("span",{className:"text-xxs font-mono text-thea-gold",children:[R,e.jsx("span",{className:"text-thea-gold-dark",children:" uptime"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(te,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),e.jsxs("span",{className:"text-xxs font-mono text-thea-gold",children:[m?"...":i.length,e.jsx("span",{className:"text-thea-gold-dark",children:" checkpoints"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-black/30 border-b border-thea-gold-dark/20",children:[e.jsx(re,{className:"w-3.5 h-3.5 text-status-success animate-pulse"}),e.jsx("h3",{className:"font-orbitron text-xxs uppercase tracking-wider text-thea-gold-bright",children:"Active Workers"}),e.jsx("span",{className:"text-xxs font-mono text-thea-gold-dark ml-auto",children:d.length})]}),d.length===0?e.jsx("div",{className:"px-4 py-6 text-center",children:e.jsx("span",{className:"text-thea-gold-dark/50 text-xs font-mono",children:"No active workers"})}):d.map(a=>e.jsx(pe,{worker:a},a.id))]}),x.filter(a=>a.status!=="running").length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-black/30 border-b border-thea-gold-dark/20 border-t border-thea-gold-dark/10",children:[e.jsx(be,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),e.jsx("h3",{className:"font-orbitron text-xxs uppercase tracking-wider text-thea-gold-dark",children:"Stopped Workers"}),e.jsx("span",{className:"text-xxs font-mono text-thea-gold-dark ml-auto",children:x.filter(a=>a.status!=="running").length})]}),x.filter(a=>a.status!=="running").map(a=>e.jsx(pe,{worker:a},a.id))]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-black/30 border-b border-thea-gold-dark/20 border-t border-thea-gold-dark/10",children:[e.jsx(te,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),e.jsx("h3",{className:"font-orbitron text-xxs uppercase tracking-wider text-thea-gold-dark",children:"Checkpoints"}),e.jsx("span",{className:"text-xxs font-mono text-thea-gold-dark ml-auto",children:m?e.jsx(M,{className:"w-3 h-3 animate-spin"}):i.length})]}),m?e.jsx("div",{className:"px-4 py-4 text-center",children:e.jsx(M,{className:"w-4 h-4 text-thea-gold-dark animate-spin mx-auto"})}):i.length===0?e.jsx("div",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"text-thea-gold-dark/50 text-xs font-mono",children:"No checkpoints"})}):i.slice(0,10).map(a=>e.jsx(Xe,{checkpoint:a},a.workerId||a.id))]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2.5 bg-black/30 border-b border-thea-gold-dark/20 border-t border-thea-gold-dark/10",children:[e.jsx(De,{className:"w-3.5 h-3.5 text-thea-gold animate-pulse-gold"}),e.jsx("h3",{className:"font-orbitron text-xxs uppercase tracking-wider text-thea-gold-bright",children:"Recent Activity"}),e.jsx("span",{className:"text-xxs font-mono text-thea-gold-dark ml-auto",children:F.length})]}),F.length===0?e.jsx("div",{className:"px-4 py-6 text-center",children:e.jsx("span",{className:"text-thea-gold-dark/50 text-xs font-mono",children:"No recent activity"})}):e.jsx("ul",{children:F.map(a=>{const v=ge[a.type]||ge.error,L=v.icon;return e.jsx("li",{className:"px-4 py-2.5 hover:bg-thea-gold/5 transition-colors border-b border-thea-gold-dark/10 last:border-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:u("w-3.5 h-3.5 flex-shrink-0",v.color)}),e.jsx("p",{className:"text-sm text-white/80 truncate font-rajdhani flex-1",children:a.message}),e.jsx("span",{className:"text-xxs text-thea-gold-deep font-mono flex-shrink-0",children:je(a.timestamp)})]})},a.id)})})]})]})]})}function nt(){const{projects:t,selectedProject:g,setSelectedProject:w,addToast:o}=U(),[b,f]=l.useState("tree"),[i,C]=l.useState(!1),[m,j]=l.useState([]),[y,N]=l.useState(null),[k,S]=l.useState([]),[n,x]=l.useState([]),[d,F]=l.useState(""),[P,R]=l.useState(!1),[p,a]=l.useState(!0),[v,L]=l.useState(!1),[$,_]=l.useState(!1),[h,A]=l.useState(!1),[W,H]=l.useState(""),[le,oe]=l.useState(!1),z=l.useCallback(async s=>{var r;try{const[c,T]=await Promise.allSettled([q("/api/projects?view=full",{signal:s}).then(D=>D.ok?D.json():Promise.reject(new Error(`HTTP ${D.status}`))),q("/api/projects/config",{signal:s}).then(D=>D.ok?D.json():Promise.reject(new Error(`HTTP ${D.status}`)))]);if(c.status==="rejected")throw c.reason;const E=c.value,O=T.status==="fulfilled"?T.value:{},B=E.folders||{},V=E.projects||[],X=[],xe=new Set;for(const[D,Y]of Object.entries(B)){const me=V.filter(ee=>ee.folder===D);me.forEach(ee=>xe.add(ee.name)),X.push({type:"folder",id:D,label:Y.label,icon:Y.icon,color:Y.color,projects:me,collapsed:!1})}const he=V.filter(D=>!xe.has(D.name));he.length>0&&X.push({type:"folder",id:"_uncategorized",label:((r=E.settings)==null?void 0:r.uncategorizedLabel)||"Other Projects",icon:"folder",color:"#888888",projects:he,collapsed:!1}),j(X),N(O),S(E.tags||[])}catch(c){if(c.name==="AbortError")return;o({type:"error",title:"Failed to load projects",message:c.message,duration:5e3})}finally{a(!1)}},[o]);l.useEffect(()=>{const s=new AbortController;return z(s.signal),()=>s.abort()},[z,t]);const ne=s=>{i||w(s===g?null:s)},Ne=s=>{x(r=>r.includes(s)?r.filter(c=>c!==s):[...r,s])},we=l.useCallback(async s=>{if(!y)return;let r={...y};switch(s.type){case"renameFolder":r.folders[s.folderId]&&(r.folders[s.folderId]={...r.folders[s.folderId],label:s.newLabel});break;case"moveProject":s.fromFolder&&r.folders[s.fromFolder]&&(r.folders[s.fromFolder].projects=r.folders[s.fromFolder].projects.filter(c=>c!==s.projectName)),s.toFolder!=="_uncategorized"&&(r.folders[s.toFolder]||(r.folders[s.toFolder]={label:s.toFolder,icon:"folder",color:"#888888",projects:[]}),r.folders[s.toFolder].projects.includes(s.projectName)||r.folders[s.toFolder].projects.push(s.projectName));break;default:return}L(!0);try{if((await q("/api/projects/config",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)N(r),await z(),o({type:"success",title:"Config saved",message:s.type==="renameFolder"?"Folder renamed":"Project moved",duration:2e3});else throw new Error("Failed to save")}catch(c){o({type:"error",title:"Failed to save",message:c.message,duration:3e3})}finally{L(!1)}},[y,z,o]),de=l.useCallback(async()=>{const s=W.trim();if(s){oe(!0);try{const r=await q("/api/projects/external",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})}),c=await r.json();r.ok&&c.success?(o({type:"success",title:"Project added",message:s.split("/").pop(),duration:3e3}),H(""),A(!1),await z()):o({type:"error",title:"Failed to add project",message:c.error||"Unknown error",duration:5e3})}catch(r){o({type:"error",title:"Failed to add project",message:r.message,duration:5e3})}finally{oe(!1)}}},[W,z,o]),Z=l.useCallback(s=>{if(!d.trim())return!0;const r=d.toLowerCase(),c=(s.name||"").toLowerCase(),T=(s.path||"").toLowerCase(),E=(s.description||"").toLowerCase(),O=(s.tags||[]).join(" ").toLowerCase(),B=(s.aliases||[]).join(" ").toLowerCase();return c.includes(r)||T.includes(r)||E.includes(r)||O.includes(r)||B.includes(r)},[d]),K=l.useMemo(()=>{if(!m.length)return t;const s=new Map;for(const r of m)for(const c of r.projects)s.set(c.name,{...c,folderLabel:r.label,folderId:r.id});return t.map(r=>s.get(r.name)||r)},[t,m]),ce=l.useMemo(()=>{let s=K;return n.length>0&&(s=s.filter(r=>n.some(c=>{var T;return(T=r.tags)==null?void 0:T.includes(c)}))),d.trim()&&(s=s.filter(Z)),P&&(s=s.filter(r=>{var c;return((c=r.workers)==null?void 0:c.length)>0||r.description})),s},[K,n,d,Z,P]),ye=l.useMemo(()=>n.length===0&&!d.trim()&&!P?m:m.map(s=>({...s,projects:s.projects.filter(r=>{var O;const c=n.length===0||n.some(B=>{var V;return(V=r.tags)==null?void 0:V.includes(B)}),T=Z(r),E=!P||((O=r.workers)==null?void 0:O.length)>0||r.description;return c&&T&&E})})).filter(s=>s.projects.length>0),[m,n,d,Z,P]),ie=l.useMemo(()=>g&&K.find(s=>s.name===g)||null,[g,K]);return p?e.jsx(Me,{message:"Loading projects...",className:"p-4"}):ie&&!i?e.jsx(Ye,{project:ie,onBack:()=>w(null)}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-thea-gold-dark/30 bg-black/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-orbitron text-sm uppercase tracking-wider text-thea-gold",children:"Projects"}),e.jsxs("p",{className:"text-xxs font-mono text-thea-gold-dark mt-0.5",children:[m.reduce((s,r)=>s+r.projects.length,0)," projects"," · ",m.reduce((s,r)=>s+r.projects.reduce((c,T)=>{var E;return c+(((E=T.workers)==null?void 0:E.filter(O=>O.status==="running").length)||0)},0),0)," active workers"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&!i&&e.jsx("button",{onClick:()=>w(null),className:"text-xs text-thea-gold-dark hover:text-thea-gold transition-colors mr-2",children:"Clear filter"}),e.jsxs("button",{onClick:()=>A(!h),className:u("flex items-center gap-1.5 px-3 py-1.5 text-xs font-rajdhani uppercase tracking-wider transition-all border",h?"bg-thea-gold/20 text-thea-gold border-thea-gold shadow-gold-sm":"text-thea-gold-dark border-thea-gold-dark/30 hover:border-thea-gold/50 hover:text-thea-gold"),title:"Add external project directory",children:[e.jsx(Ve,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Add"})]}),b==="tree"&&e.jsxs("button",{onClick:()=>C(!i),disabled:v,className:u("flex items-center gap-1.5 px-3 py-1.5 text-xs font-rajdhani uppercase tracking-wider transition-all border",i?"bg-thea-gold/20 text-thea-gold border-thea-gold shadow-gold-sm":"text-thea-gold-dark border-thea-gold-dark/30 hover:border-thea-gold/50 hover:text-thea-gold"),children:[v?e.jsx(M,{className:"w-3.5 h-3.5 animate-spin"}):i?e.jsx(fe,{className:"w-3.5 h-3.5"}):e.jsx(ke,{className:"w-3.5 h-3.5"}),i?"Done":"Edit"]}),e.jsxs("div",{className:"flex border border-thea-gold-dark/50",role:"tablist","aria-label":"Project view mode",children:[e.jsx("button",{role:"tab","aria-selected":b==="tree",onClick:()=>{f("tree")},className:u("p-1.5 transition-colors",b==="tree"?"bg-thea-gold/20 text-thea-gold":"text-thea-gold-dark hover:text-thea-gold"),title:"Tree view","aria-label":"Tree view",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx("button",{role:"tab","aria-selected":b==="grid",onClick:()=>{f("grid"),C(!1)},className:u("p-1.5 transition-colors border-l border-thea-gold-dark/50",b==="grid"?"bg-thea-gold/20 text-thea-gold":"text-thea-gold-dark hover:text-thea-gold"),title:"Grid view","aria-label":"Grid view",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})]}),!i&&e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx(Ie,{value:d,onChange:F,placeholder:"Search projects...",className:"flex-1"}),e.jsx("button",{onClick:()=>R(!P),className:u("text-xxs px-2 py-2 font-mono uppercase tracking-wider transition-all border whitespace-nowrap",P?"bg-thea-gold/20 text-thea-gold border-thea-gold":"text-thea-gold-dark border-thea-gold-dark/30 hover:border-thea-gold/50"),children:"Hide Empty"})]}),i&&e.jsxs("div",{className:"mb-3 px-3 py-2 bg-thea-gold/10 border border-thea-gold/30 text-xs text-thea-gold",children:[e.jsx("span",{className:"font-bold",children:"Edit Mode:"})," Drag projects between folders. Click folder names to rename."]}),h&&e.jsxs("div",{className:"mb-3 px-3 py-2.5 bg-thea-gold/10 border border-thea-gold/30",children:[e.jsx("div",{className:"text-xs text-thea-gold font-bold mb-2",children:"Add External Project"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:W,onChange:s=>H(s.target.value),onKeyDown:s=>{s.key==="Enter"&&de(),s.key==="Escape"&&A(!1)},placeholder:"/absolute/path/to/project",autoFocus:!0,className:"flex-1 bg-black/50 border border-thea-gold-dark/30 px-3 py-1.5 text-sm text-thea-gold placeholder-thea-gold-dark/50 focus:outline-none focus:border-thea-gold/50 transition-colors font-mono"}),e.jsx("button",{onClick:de,disabled:le||!W.trim(),className:"px-3 py-1.5 text-xs font-rajdhani uppercase tracking-wider bg-thea-gold/20 text-thea-gold border border-thea-gold hover:bg-thea-gold/30 transition-all disabled:opacity-40 disabled:cursor-not-allowed",children:le?e.jsx(M,{className:"w-3.5 h-3.5 animate-spin"}):"Add"}),e.jsx("button",{onClick:()=>{A(!1),H("")},className:"px-2 py-1.5 text-thea-gold-dark hover:text-thea-gold transition-colors",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xxs text-thea-gold-dark mt-1.5 font-mono",children:"Absolute path to an external project directory. Press Enter to add, Esc to cancel."})]}),k.length>0&&!i&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(_e,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),k.map(s=>e.jsx("button",{onClick:()=>Ne(s),className:u("text-xxs px-2 py-1 font-mono uppercase tracking-wider transition-all","border",n.includes(s)?"bg-thea-gold/20 text-thea-gold border-thea-gold shadow-gold-sm":"text-thea-gold-dark border-thea-gold-dark/30 hover:border-thea-gold/50 hover:text-thea-gold"),children:s},s)),n.length>0&&e.jsxs("button",{onClick:()=>x([]),className:"text-xxs px-2 py-1 text-thea-maroon-light hover:text-thea-maroon-light/80 transition-colors flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),"Clear"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:b==="tree"?e.jsx(Qe,{tree:ye,selectedProject:g,onSelectProject:ne,editMode:i,onConfigChange:we}):e.jsx("div",{className:"p-4",children:ce.length===0?e.jsx("div",{className:"text-center py-8 text-thea-gold-dark/50 text-sm",children:d?`No projects match "${d}"`:"No projects match the selected filters"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:ce.map(s=>e.jsx(Je,{project:s,isSelected:g===s.name,onSelect:ne,folderLabel:s.folderId!=="_uncategorized"?s.folderLabel:void 0},s.name))})})})]})}export{nt as ProjectsView};
