import{c as b,u as S,j as e,a as d,B as j,E as k,k as p,g as N,e as y,C as v,p as C,n as B,H as R,D as O,z as g,G as A}from"./index-UNso8H13.js";import{r as u}from"./vendor-react-wGySg1uH.js";import{C as M}from"./check-circle-2-BT9DuphP.js";import"./vendor-socket-TjCxX7sJ.js";import"./vendor-terminal-CyaXSNWE.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=b("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=b("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=b("Signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]),_={blocked:{label:"BLOCKED",headerColor:"text-red-400",headerBg:"bg-red-500/10 border-red-500/30",badgeColor:"text-red-400 bg-red-400/10 border-red-400/30",icon:p,countBg:"bg-red-500/20 text-red-300"},in_progress:{label:"IN PROGRESS",headerColor:"text-yellow-400",headerBg:"bg-yellow-500/10 border-yellow-500/30",badgeColor:"text-yellow-400 bg-yellow-400/10 border-yellow-400/30",icon:y,countBg:"bg-yellow-500/20 text-yellow-300"},done:{label:"DONE",headerColor:"text-green-400",headerBg:"bg-green-500/10 border-green-500/30",badgeColor:"text-green-400 bg-green-400/10 border-green-400/30",icon:M,countBg:"bg-green-500/20 text-green-300"},pending:{label:"PENDING",headerColor:"text-thea-gold-dark",headerBg:"bg-thea-gold/10 border-thea-gold-dark/30",badgeColor:"text-thea-gold-dark bg-thea-gold/10 border-thea-gold-dark/30",icon:N,countBg:"bg-thea-gold/20 text-thea-gold"}},m=["blocked","in_progress","done","pending"];function E({groups:s}){var o,l,t,c;const a=m.reduce((x,n)=>{var f;return x+(((f=s[n])==null?void 0:f.length)||0)},0),h=s.in_progress||[],r=h.length>0?Math.round(h.reduce((x,n)=>x+(n.ralphProgress||0),0)/h.length):0,i=((o=s.blocked)==null?void 0:o.length)||0;return e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 border-b border-thea-gold-dark/20 bg-black/30 text-xxs font-mono flex-wrap",children:[e.jsxs("span",{className:"text-thea-gold-dark",children:[e.jsx("span",{className:"text-thea-gold",children:a})," total"]}),(((l=s.in_progress)==null?void 0:l.length)||0)>0&&e.jsxs("span",{className:"text-yellow-400",children:[s.in_progress.length," working",e.jsxs("span",{className:"text-thea-gold-dark ml-1",children:["avg ",r,"%"]})]}),(((t=s.done)==null?void 0:t.length)||0)>0&&e.jsxs("span",{className:"text-green-400",children:[s.done.length," done"]}),i>0&&e.jsxs("span",{className:"text-red-400 animate-pulse",children:[e.jsx(p,{className:"w-3 h-3 inline-block mr-0.5 -mt-0.5"}),i," blocked"]}),(((c=s.pending)==null?void 0:c.length)||0)>0&&e.jsxs("span",{className:"text-thea-gold-dark",children:[s.pending.length," pending"]})]})}function T({status:s,workers:a,attachToWorker:h}){const r=_[s],[i,o]=u.useState(!1);if(!a||a.length===0)return null;const l=r.icon;return e.jsxs("div",{className:"border-b border-thea-gold-dark/10 last:border-b-0",children:[e.jsxs("button",{onClick:()=>o(t=>!t),className:d("w-full flex items-center gap-2 px-4 py-2 border-l-2 transition-colors hover:bg-white/5",r.headerBg),children:[e.jsx(l,{className:d("w-3.5 h-3.5 flex-shrink-0",r.headerColor,s==="in_progress"&&"animate-spin")}),e.jsx("span",{className:d("text-[11px] font-orbitron uppercase tracking-wider",r.headerColor),children:r.label}),e.jsx("span",{className:d("text-xxs px-1.5 py-0 rounded-full font-mono",r.countBg),children:a.length}),e.jsx(v,{className:d("w-3 h-3 ml-auto text-thea-gold-dark transition-transform",i&&"-rotate-90")})]}),!i&&e.jsx("div",{className:"divide-y divide-thea-gold-dark/5",children:a.map(t=>e.jsx(z,{worker:t,status:s,attachToWorker:h},t.id))})]})}function L(s){return s.status!=="running"||s.ralphStatus!=="in_progress"?!1:s.lastRalphSignalAt?Date.now()-new Date(s.lastRalphSignalAt).getTime()>30*60*1e3:!0}function z({worker:s,status:a,attachToWorker:h}){var x;const[r,i]=u.useState(!1),{displayName:o}=C(s.label),l=a==="blocked",t=a==="done",c=L(s);return e.jsxs("div",{className:d("px-4 py-3 transition-colors hover:bg-thea-gold/5",l&&"border-l-2 border-red-500 bg-red-500/5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(B,{label:s.label,size:"sm"}),e.jsx("button",{onClick:()=>h(s.id),className:"text-sm text-white/90 font-rajdhani truncate hover:text-thea-gold-bright transition-colors text-left min-w-0 flex-1",title:`Focus on ${s.label}`,children:o}),e.jsx(R,{score:s.healthScore,size:"sm"}),e.jsx("span",{className:d("text-xxs px-1.5 py-0.5 border font-mono uppercase flex-shrink-0",s.status==="running"?"bg-green-400/10 text-green-400 border-green-400/30":"bg-gray-500/10 text-gray-400 border-gray-500/30"),children:s.status})]}),a==="in_progress"&&s.ralphProgress!=null&&e.jsxs("div",{className:"mb-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:"text-xxs font-mono text-thea-gold-dark",children:"progress"}),e.jsxs("span",{className:"text-xxs font-mono text-thea-gold",children:[s.ralphProgress,"%"]})]}),e.jsx(O,{progress:s.ralphProgress})]}),s.ralphCurrentStep&&e.jsx("p",{className:"text-xxs text-thea-gold-dark/70 font-mono truncate mb-1.5",title:s.ralphCurrentStep,children:s.ralphCurrentStep}),c&&e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 px-2 py-1 bg-yellow-500/10 border border-yellow-500/30 text-xxs text-yellow-400 font-mono",children:[e.jsx(p,{className:"w-3 h-3 flex-shrink-0"}),e.jsxs("span",{children:["Signal stale â€” worker active but hasn't reported in ",(x=g(s.lastRalphSignalAt))==null?void 0:x.replace(" ago","")]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xxs font-mono text-thea-gold-dark/50 flex-wrap",children:[s.ralphSignalCount>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-2.5 h-2.5"}),s.ralphSignalCount," signals"]}),s.lastRalphSignalAt&&e.jsxs("span",{className:d("flex items-center gap-1",c&&"text-yellow-500/70"),children:[e.jsx(N,{className:"w-2.5 h-2.5"}),g(s.lastRalphSignalAt)]}),s.status==="running"&&s.lastActivity&&e.jsxs("span",{className:"flex items-center gap-1 text-green-500/60",children:[e.jsx(y,{className:"w-2.5 h-2.5 animate-spin"}),"active ",g(s.lastActivity)]})]}),l&&s.ralphBlockedReason&&e.jsxs("div",{className:"mt-2 px-2 py-1.5 bg-red-500/10 border border-red-500/30 text-[11px] text-red-300 font-mono flex items-start gap-1.5",children:[e.jsx(p,{className:"w-3 h-3 flex-shrink-0 mt-0.5 animate-pulse"}),e.jsx("span",{children:s.ralphBlockedReason})]}),t&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[s.ralphLearnings&&e.jsxs("div",{className:"text-xxs font-mono",children:[e.jsxs("button",{onClick:()=>i(n=>!n),className:"flex items-center gap-1 text-green-400/80 hover:text-green-400 transition-colors mb-0.5",children:[e.jsx(P,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:"learnings"}),e.jsx(v,{className:d("w-2.5 h-2.5 transition-transform",r&&"rotate-180")})]}),e.jsx("p",{className:d("text-thea-gold-dark/60 whitespace-pre-wrap pl-4",!r&&"line-clamp-2"),children:s.ralphLearnings})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.ralphOutputs&&(typeof s.ralphOutputs=="string"?s.ralphOutputs.length>0:Object.keys(s.ralphOutputs).length>0)&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xxs font-mono text-thea-gold-dark/60",children:[e.jsx(w,{className:"w-2.5 h-2.5"}),(()=>{const n=typeof s.ralphOutputs=="string"?s.ralphOutputs.length:Object.keys(s.ralphOutputs).length;return`${n} output${n!==1?"s":""}`})()]}),s.ralphArtifacts&&s.ralphArtifacts.length>0&&e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:s.ralphArtifacts.map(n=>e.jsxs("span",{className:"text-xxxs font-mono px-1.5 py-0.5 bg-purple-500/10 border border-purple-500/30 text-purple-300 truncate max-w-[120px]",title:n,children:[e.jsx(A,{className:"w-2.5 h-2.5 inline-block mr-0.5 -mt-0.5"}),typeof n=="string"?n.split("/").pop():n]},n))})]})]})]})}function H({className:s=""}){const{workers:a,attachToWorker:h}=S(),{ralphWorkers:r,groups:i}=u.useMemo(()=>{const o=a.filter(t=>t.ralphMode),l={};for(const t of m)l[t]=[];for(const t of o){const c=t.ralphStatus||"pending";l[c]?l[c].push(t):l.pending.push(t)}return l.in_progress.sort((t,c)=>(c.ralphProgress||0)-(t.ralphProgress||0)),{ralphWorkers:o,groups:l}},[a]);return e.jsxs("div",{className:d("bg-gradient-to-b from-thea-nearBlack/80 to-black/60 flex flex-col",s),children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-3 border-b border-thea-gold-dark/30 bg-black/40",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-thea-gold animate-pulse-gold"}),e.jsx("h3",{className:"font-orbitron text-xs uppercase tracking-[0.15em] text-thea-gold-bright text-glow-gold-sm",children:"Ralph Dashboard"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:r.length===0?e.jsx(k,{icon:j,message:"No Ralph-enabled workers",className:"py-6"}):e.jsxs(e.Fragment,{children:[e.jsx(E,{groups:i}),m.map(o=>e.jsx(T,{status:o,workers:i[o],attachToWorker:h},o))]})})]})}export{H as RalphPanel};
