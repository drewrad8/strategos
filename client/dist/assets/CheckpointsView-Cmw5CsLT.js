import{c as L,f as I,j as e,o as D,X as v,g as E,a as u,C as M,b as O,w as T,x as $,k as C,Z as F,d as P}from"./index-Cxbqd1Zv.js";import{r as d}from"./vendor-react-wGySg1uH.js";import{C as A}from"./check-circle-2-njEiRCLg.js";import"./vendor-socket-TjCxX7sJ.js";import"./vendor-terminal-CyaXSNWE.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=L("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=L("Skull",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]),B={killed:{color:"text-yellow-400",bg:"bg-yellow-400/10 border-yellow-400/30",icon:F,label:"Killed"},crashed:{color:"text-red-400",bg:"bg-red-400/10 border-red-400/30",icon:z,label:"Crashed"},completed:{color:"text-green-400",bg:"bg-green-400/10 border-green-400/30",icon:A,label:"Completed"},dismissed:{color:"text-blue-400",bg:"bg-blue-400/10 border-blue-400/30",icon:A,label:"Dismissed"}};function k(r){if(!r)return{color:"text-thea-gold-dark",bg:"bg-thea-gold/10 border-thea-gold-dark/30",icon:C,label:"Unknown"};const l=r.toLowerCase();for(const[c,n]of Object.entries(B))if(l.includes(c))return n;return{color:"text-thea-gold-dark",bg:"bg-thea-gold/10 border-thea-gold-dark/30",icon:C,label:r}}function Q({status:r,progress:l}){if(!r)return null;const c={done:"text-green-400 bg-green-400/10 border-green-400/30",in_progress:"text-blue-400 bg-blue-400/10 border-blue-400/30",blocked:"text-red-400 bg-red-400/10 border-red-400/30"};return e.jsxs("span",{className:u("text-[10px] px-1.5 py-0.5 border font-mono uppercase",c[r]||"text-thea-gold-dark bg-thea-gold/10 border-thea-gold-dark/30"),children:[r,l!=null&&l<100?` ${l}%`:""]})}function V({text:r}){const[l,c]=d.useState(!1),n=()=>{navigator.clipboard.writeText(r).then(()=>{c(!0),setTimeout(()=>c(!1),1500)})};return e.jsx("button",{onClick:n,className:"p-1 text-thea-gold-dark hover:text-thea-gold transition-colors",title:"Copy output",children:l?e.jsx(P,{className:"w-3.5 h-3.5 text-green-400"}):e.jsx(q,{className:"w-3.5 h-3.5"})})}function Z({checkpoint:r}){const{lastOutput:l,ralphLearnings:c,ralphOutputs:n,ralphArtifacts:x,crashReason:m,task:i,ralphCurrentStep:g,parentLabel:b,childWorkerIds:p}=r;return e.jsxs("div",{className:"border-t border-thea-gold-dark/20 bg-black/40 px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-[11px] font-mono text-thea-gold-dark",children:[e.jsxs("span",{children:["ID: ",e.jsx("span",{className:"text-thea-gold",children:r.workerId})]}),r.project&&e.jsxs("span",{children:["Project: ",e.jsx("span",{className:"text-thea-gold",children:r.project})]}),b&&e.jsxs("span",{children:["Parent: ",e.jsx("span",{className:"text-thea-gold",children:b})]}),(p==null?void 0:p.length)>0&&e.jsxs("span",{children:["Children: ",e.jsx("span",{className:"text-thea-gold",children:p.length})]}),r.createdAt&&e.jsxs("span",{children:["Created: ",e.jsx("span",{className:"text-thea-gold",children:new Date(r.createdAt).toLocaleString()})]})]}),(i==null?void 0:i.description)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-mono text-thea-gold-dark uppercase tracking-wider mb-1",children:"Task"}),e.jsx("p",{className:"text-sm text-thea-gold/80 font-rajdhani",children:i.description})]}),g&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-mono text-thea-gold-dark uppercase tracking-wider mb-1",children:"Last Step"}),e.jsx("p",{className:"text-sm text-thea-gold/80 font-rajdhani",children:g})]}),m&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-mono text-red-400/70 uppercase tracking-wider mb-1",children:"Crash Reason"}),e.jsx("p",{className:"text-sm text-red-300 font-mono",children:m})]}),c&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-mono text-thea-gold-dark uppercase tracking-wider mb-1",children:"Learnings"}),e.jsx("p",{className:"text-sm text-thea-gold/80 font-rajdhani whitespace-pre-wrap",children:c})]}),(Array.isArray(n)&&n.length>0||Array.isArray(x)&&x.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2",children:[Array.isArray(n)&&n.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-mono text-thea-gold-dark uppercase tracking-wider mb-1",children:"Outputs"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.map(o=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-thea-gold/10 border border-thea-gold-dark/30 text-thea-gold font-mono truncate max-w-[200px]",title:o,children:o},o))})]}),Array.isArray(x)&&x.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-mono text-thea-gold-dark uppercase tracking-wider mb-1",children:"Artifacts"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:x.map(o=>e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-blue-400/10 border border-blue-400/30 text-blue-400 font-mono",children:o},o))})]})]}),l&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-[10px] font-mono text-thea-gold-dark uppercase tracking-wider",children:"Last Output"}),e.jsx(V,{text:l})]}),e.jsx("pre",{className:"bg-black/80 border border-thea-gold-dark/20 p-3 text-[11px] text-gray-300 font-mono overflow-x-auto max-h-64 overflow-y-auto whitespace-pre-wrap leading-relaxed scrollbar-thin",children:l})]})]})}function X(){const[r,l]=d.useState([]),[c,n]=d.useState(!0),[x,m]=d.useState(null),[i,g]=d.useState(""),[b,p]=d.useState(null),[o,w]=d.useState(null),f=d.useCallback(async t=>{try{const a=await I("/api/checkpoints",{signal:t});if(!a.ok)throw new Error(`HTTP ${a.status}`);const s=await a.json(),h=Array.isArray(s)?s:[];h.sort((S,R)=>new Date(R.diedAt||0)-new Date(S.diedAt||0)),l(h),m(null)}catch(a){if(a.name==="AbortError")return;m(a.message)}finally{n(!1)}},[]);d.useEffect(()=>{const t=new AbortController;return f(t.signal),()=>t.abort()},[f]);const N=d.useMemo(()=>{const t=new Set;for(const a of r)a.reason&&t.add(a.reason.toLowerCase());return[...t].sort()},[r]);d.useMemo(()=>{const t=new Set;for(const a of r)a.project&&t.add(a.project);return[...t].sort()},[r]);const y=d.useMemo(()=>{let t=r;if(o&&(t=t.filter(a=>(a.reason||"").toLowerCase()===o)),i.trim()){const a=i.toLowerCase();t=t.filter(s=>{var h;return(s.label||"").toLowerCase().includes(a)||(s.project||"").toLowerCase().includes(a)||(s.workerId||"").toLowerCase().includes(a)||(s.ralphLearnings||"").toLowerCase().includes(a)||(((h=s.task)==null?void 0:h.description)||"").toLowerCase().includes(a)})}return t},[r,i,o]),j=d.useMemo(()=>{const t={};for(const a of r){const s=(a.reason||"unknown").toLowerCase();t[s]=(t[s]||0)+1}return{total:r.length,byReason:t}},[r]);return c?e.jsx("div",{className:"p-4 flex items-center justify-center",children:e.jsx("div",{className:"text-thea-gold-dark text-sm font-mono animate-pulse",children:"Loading checkpoints..."})}):x?e.jsxs("div",{className:"p-4 flex flex-col items-center justify-center gap-3",children:[e.jsxs("div",{className:"text-red-400 text-sm font-mono",children:["Failed to load checkpoints: ",x]}),e.jsx("button",{onClick:()=>{n(!0),f()},className:"thea-btn px-4 py-2 text-sm",children:"Retry"})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-thea-gold-dark/30 bg-black/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-orbitron text-sm uppercase tracking-wider text-thea-gold",children:"Checkpoints"}),e.jsxs("p",{className:"text-[10px] font-mono text-thea-gold-dark mt-0.5",children:[j.total," dead workers",Object.entries(j.byReason).map(([t,a])=>{const s=k(t);return` · ${a} ${s.label.toLowerCase()}`}).join("")]})]}),e.jsx("button",{onClick:()=>{n(!0),f()},className:"thea-btn px-3 py-1.5 text-xs font-rajdhani uppercase tracking-wider",children:"Refresh"})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"relative",role:"search",children:[e.jsx(D,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-thea-gold-dark pointer-events-none","aria-hidden":"true"}),e.jsx("input",{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:"Search by label, project, ID, or learnings...",className:"w-full bg-black/50 border border-thea-gold-dark/30 pl-10 pr-10 py-2 text-sm text-thea-gold placeholder-thea-gold-dark/50 focus:outline-none focus:border-thea-gold/50 transition-colors font-mono","aria-label":"Search checkpoints"}),i&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-thea-gold-dark hover:text-thea-gold transition-colors","aria-label":"Clear search",children:e.jsx(v,{className:"w-4 h-4"})})]})}),N.length>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(E,{className:"w-3.5 h-3.5 text-thea-gold-dark"}),N.map(t=>{const a=k(t),s=a.icon;return e.jsxs("button",{onClick:()=>w(o===t?null:t),className:u("flex items-center gap-1 text-[10px] px-2 py-1 font-mono uppercase tracking-wider transition-all border",o===t?a.bg+" "+a.color+" shadow-sm":"text-thea-gold-dark border-thea-gold-dark/30 hover:border-thea-gold/50 hover:text-thea-gold"),children:[e.jsx(s,{className:"w-3 h-3"}),a.label," (",j.byReason[t]||0,")"]},t)}),o&&e.jsxs("button",{onClick:()=>w(null),className:"text-[10px] px-2 py-1 text-thea-maroon-light hover:text-thea-maroon-light/80 transition-colors flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),"Clear"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:y.length===0?e.jsx("div",{className:"text-center py-12 text-thea-gold-dark/50 text-sm font-mono",children:r.length===0?"No checkpoints yet — dead workers will appear here":`No checkpoints match "${i||o}"`}):e.jsx("div",{className:"divide-y divide-thea-gold-dark/10",children:y.map(t=>{const a=b===t.workerId,s=k(t.reason),h=s.icon;return e.jsxs("div",{className:u("transition-colors",a&&"bg-thea-gold/[0.03]"),children:[e.jsxs("button",{onClick:()=>p(a?null:t.workerId),className:"w-full text-left px-4 py-3 flex items-center gap-3 hover:bg-thea-gold/[0.05] transition-colors group","aria-expanded":a,"aria-label":`Checkpoint: ${t.label||t.workerId}`,children:[e.jsx("span",{className:"text-thea-gold-dark group-hover:text-thea-gold transition-colors shrink-0",children:a?e.jsx(M,{className:"w-4 h-4"}):e.jsx(O,{className:"w-4 h-4"})}),e.jsx("span",{className:u("shrink-0",s.color),children:e.jsx(h,{className:"w-4 h-4"})}),e.jsx("span",{className:"flex-1 min-w-0 truncate text-sm font-rajdhani text-thea-gold group-hover:text-thea-gold-bright transition-colors",children:t.label||t.workerId}),t.project&&e.jsx("span",{className:"hidden sm:inline text-[10px] px-1.5 py-0.5 bg-thea-gold/10 border border-thea-gold-dark/30 text-thea-gold-dark font-mono truncate max-w-[120px]",children:t.project}),e.jsx(Q,{status:t.ralphStatus,progress:t.ralphProgress}),e.jsx("span",{className:u("text-[10px] px-1.5 py-0.5 border font-mono uppercase",s.bg,s.color),children:s.label}),e.jsx("span",{className:"text-[10px] font-mono text-thea-gold-dark w-16 text-right shrink-0",children:T(t.uptime)}),e.jsx("span",{className:"text-[10px] font-mono text-thea-gold-dark w-16 text-right shrink-0 hidden sm:inline",children:$(t.diedAt)})]}),a&&e.jsx(Z,{checkpoint:t})]},t.workerId)})})})]})}export{X as CheckpointsView};
