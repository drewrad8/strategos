import{u as O,s as P,f as Y,j as e,A as q,a as h,V as B,t as D,v as F,e as J,w as W,x as X}from"./index-ClVyAEKc.js";import{r as s}from"./vendor-react-wGySg1uH.js";import"./vendor-socket-TjCxX7sJ.js";import"./vendor-terminal-CyaXSNWE.js";function Z({onExit:T}){const{workers:b}=O(),{isListening:t,isSpeaking:o,transcript:n,sttSupported:j,ttsSupported:C,startListening:c,stopListening:f,clearTranscript:d,speak:m,stopSpeaking:k}=P(),[x,N]=s.useState(!1),[z,L]=s.useState(null),[w,p]=s.useState([]),u=s.useRef(0),[a,E]=s.useState(!0),[v,G]=s.useState(!0),S=s.useCallback(async r=>{if(!r.trim())return;N(!0);const R=++u.current;p(i=>[...i,{id:R,role:"user",content:r}].slice(-100));try{const l=await(await Y("/api/voice/command",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r})})).json();L(l);const g=++u.current;p(A=>[...A,{id:g,role:"assistant",content:l.spoken||"Action completed."}].slice(-100)),a&&l.spoken&&await m(l.spoken),v&&!t&&setTimeout(()=>{c()},500)}catch{const i="Sorry, I had trouble processing that request.",l=++u.current;p(g=>[...g,{id:l,role:"assistant",content:i}].slice(-100)),a&&await m(i)}finally{N(!1)}},[a,m,v,t,c]),y=s.useCallback(()=>{t&&f(),n.trim()&&(S(n),d())},[t,f,n,S,d]),M=s.useCallback(()=>{o&&k(),t?y():(d(),c())},[t,o,k,y,d,c]),V=()=>x?"bg-amber-500":o?"bg-blue-500":t?"bg-red-500":"bg-thea-gold",I=()=>x?"Thinking...":o?"Speaking...":t?"Listening...":"Ready";return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-b from-black to-thea-nearBlack",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-thea-gold-dark/20",children:[e.jsxs("button",{onClick:T,className:"flex items-center gap-2 text-thea-gold hover:text-thea-gold-bright transition-colors","aria-label":"Exit voice mode",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{className:"font-rajdhani font-semibold",children:"Exit Voice Mode"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>E(!a),className:h("p-2 rounded transition-colors",a?"text-thea-gold-bright bg-thea-gold/20":"text-thea-gold-dark"),title:a?"Disable voice responses":"Enable voice responses",children:a?e.jsx(B,{className:"w-5 h-5"}):e.jsx(D,{className:"w-5 h-5"})}),e.jsx("div",{className:"px-3 py-1 bg-black/50 rounded border border-thea-gold-dark/30",children:e.jsxs("span",{className:"text-xs text-thea-gold-dark",children:[b.length," worker",b.length!==1?"s":""]})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[w.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 mx-auto mb-4 text-thea-gold-dark/30"}),e.jsx("h2",{className:"text-xl font-orbitron text-thea-gold-dark mb-2",children:"Voice Mode Active"}),e.jsx("p",{className:"text-sm text-thea-gold-dark/50 max-w-sm mx-auto",children:"Tap the microphone to speak. You can ask about worker status, start new workers, approve or reject pending actions, and more."}),e.jsxs("div",{className:"mt-6 space-y-2 text-left max-w-sm mx-auto",children:[e.jsx("p",{className:"text-xs text-thea-gold-dark/70",children:"Try saying:"}),e.jsxs("ul",{className:"text-xs text-thea-gold-dark/50 space-y-1",children:[e.jsx("li",{children:`"What's the status of my workers?"`}),e.jsx("li",{children:'"Start a new worker on strategos"'}),e.jsx("li",{children:'"Yes, approve that"'}),e.jsx("li",{children:'"Send help me with testing to the worker"'})]})]})]}):w.map(r=>e.jsxs("div",{className:h("p-4 rounded-lg",r.role==="user"?"bg-thea-gold/10 border border-thea-gold/20 ml-8":"bg-black/50 border border-thea-gold-dark/20 mr-8"),children:[e.jsx("div",{className:"text-xs text-thea-gold-dark/50 mb-1",children:r.role==="user"?"You":"Strategos"}),e.jsx("p",{className:"text-sm text-white",children:r.content})]},r.id)),n&&e.jsxs("div",{className:"p-4 rounded-lg bg-thea-gold/5 border border-thea-gold/30 ml-8 animate-pulse",children:[e.jsx("div",{className:"text-xs text-thea-gold/70 mb-1",children:"You (listening...)"}),e.jsx("p",{className:"text-sm text-thea-gold",children:n})]}),x&&e.jsx("div",{className:"p-4 rounded-lg bg-black/50 border border-amber-500/20 mr-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-500",children:[e.jsx(J,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Processing..."})]})})]})}),e.jsx("div",{className:"p-6 border-t border-thea-gold-dark/20",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",role:"status","aria-live":"polite",children:[e.jsx("span",{className:h("w-2 h-2 rounded-full",V())}),e.jsx("span",{className:"text-sm text-thea-gold-dark",children:I()})]}),e.jsx("button",{onClick:M,disabled:x||!j,"aria-label":t?"Stop listening and send":"Start listening",className:h("w-24 h-24 rounded-full flex items-center justify-center transition-all","border-4",t?"bg-red-500/20 border-red-500 text-red-400 animate-pulse scale-110":o?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-thea-gold/10 border-thea-gold text-thea-gold hover:bg-thea-gold/20 hover:scale-105","disabled:opacity-50 disabled:cursor-not-allowed"),children:t?e.jsx(W,{className:"w-10 h-10"}):e.jsx(X,{className:"w-10 h-10"})}),e.jsx("p",{className:"text-xs text-thea-gold-dark/50 text-center",children:t?"Tap to stop and send":o?"Speaking response...":"Tap to start listening"}),!j&&e.jsx("p",{className:"text-xs text-red-400 text-center",children:"Speech recognition not supported in this browser"}),!C&&a&&e.jsx("p",{className:"text-xs text-amber-400 text-center",children:"Speech synthesis not available"})]})})]})}export{Z as VoiceModeView};
