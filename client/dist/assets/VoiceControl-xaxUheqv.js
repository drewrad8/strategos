import{u as _,s as A,j as e,a as w,w as D,x as M,V as K,t as Q,I as P,C as R,J as H,X as O}from"./index-LKxO3zUX.js";import{r as g}from"./vendor-react-wGySg1uH.js";import"./vendor-socket-TjCxX7sJ.js";import"./vendor-terminal-CyaXSNWE.js";const z=[{name:"spawn_worker",patterns:[/spawn\s+(?:a\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i,/start\s+(?:a\s+)?(?:new\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i,/create\s+(?:a\s+)?(?:new\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i,/launch\s+(?:a\s+)?worker(?:\s+(?:on|for|in)\s+(.+))?/i]},{name:"stop_worker",patterns:[/stop\s+(?:the\s+)?worker(?:\s+(.+))?/i,/kill\s+(?:the\s+)?worker(?:\s+(.+))?/i,/terminate\s+(?:the\s+)?worker(?:\s+(.+))?/i,/end\s+(?:the\s+)?worker(?:\s+(.+))?/i,/stop\s+all\s+workers/i,/kill\s+all\s+workers/i]},{name:"send_message",patterns:[/send\s+(?:message\s+)?["']?(.+?)["']?\s+(?:to\s+)?(?:the\s+)?(?:worker)?(?:\s+(.+))?$/i,/tell\s+(?:the\s+)?worker(?:\s+(.+))?\s+(?:to\s+)?["']?(.+?)["']?$/i,/message\s+(?:the\s+)?worker(?:\s+(.+))?\s+(?:with\s+)?["']?(.+?)["']?$/i]},{name:"show_status",patterns:[/(?:show|display|what(?:'s|\s+is)?)\s+(?:the\s+)?status/i,/status(?:\s+(?:of|for)\s+(?:the\s+)?workers?)?/i,/how\s+(?:are|is)\s+(?:the\s+)?workers?\s+doing/i,/worker\s+status/i,/list\s+workers/i,/what\s+workers\s+(?:are\s+)?running/i]}];function W(s){const r=s.trim().toLowerCase();for(const l of z)for(const o of l.patterns){const u=r.match(o);if(u)return{command:l.name,matches:u.slice(1).filter(Boolean),raw:s}}return null}function T(s,r){if(!r)return null;const l=r.toLowerCase().trim();let o=s.find(u=>{var c;return u.id===l||((c=u.label)==null?void 0:c.toLowerCase())===l});return o||(o=s.find(u=>{var c,f;return((c=u.label)==null?void 0:c.toLowerCase().includes(l))||((f=u.projectPath)==null?void 0:f.toLowerCase().includes(l))})),o}function U(s,r){if(!r)return null;const l=r.toLowerCase().trim();let o=s.find(u=>{var c;return((c=u.name)==null?void 0:c.toLowerCase())===l});return o||(o=s.find(u=>{var c;return(c=u.name)==null?void 0:c.toLowerCase().includes(l)})),o}function X(){const{workers:s,projects:r,spawnWorker:l,killWorker:o,sendInput:u,focusedWorker:c,addToast:f}=_(),x=g.useCallback(async h=>{if(!h)return{success:!1,message:"Command not recognized",spoken:"I didn't understand that command. Try spawn worker, stop worker, send message, or show status."};const{command:j,matches:p}=h;switch(j){case"spawn_worker":{const i=p[0];if(i){const t=U(r,i);return t?(await l(t.path,`${t.name} Worker`),{success:!0,message:`Spawning worker for ${t.name}`,spoken:`Spawning a new worker for ${t.name}.`}):{success:!1,message:`Project "${i}" not found`,spoken:`I couldn't find a project matching "${i}". Try saying the exact project name.`}}else if(r.length>0){const t=r[0];return await l(t.path,`${t.name} Worker`),{success:!0,message:`Spawning worker for ${t.name}`,spoken:`Spawning a new worker for ${t.name}.`}}else return{success:!1,message:"No projects available",spoken:"No projects are available to spawn a worker."}}case"stop_worker":{const i=p[0];if(h.raw.toLowerCase().includes("all")){const a=s.filter(d=>d.status==="running");return a.length===0?{success:!1,message:"No workers running",spoken:"There are no workers running to stop."}:(a.forEach(d=>o(d.id)),{success:!0,message:`Stopping ${a.length} workers`,spoken:`Stopping all ${a.length} workers.`})}if(i){const a=T(s,i);return a?(o(a.id),{success:!0,message:`Stopping worker ${a.label||a.id}`,spoken:`Stopping worker ${a.label||"unnamed"}.`}):{success:!1,message:`Worker "${i}" not found`,spoken:`I couldn't find a worker matching "${i}".`}}else if(c){const a=s.find(d=>d.id===c);return o(c),{success:!0,message:"Stopping focused worker",spoken:`Stopping the focused worker ${(a==null?void 0:a.label)||""}.`}}else return s.length===1?(o(s[0].id),{success:!0,message:`Stopping worker ${s[0].label||s[0].id}`,spoken:"Stopping the only running worker."}):{success:!1,message:"Please specify which worker to stop",spoken:"Please specify which worker to stop. You can say stop worker followed by the worker name, or say stop all workers."}}case"send_message":{let i=p[0],t=p[1];if((h.raw.toLowerCase().startsWith("tell")||h.raw.toLowerCase().startsWith("message"))&&(t=p[0],i=p[1]),!i)return{success:!1,message:"No message specified",spoken:"Please specify a message to send."};let a;if(t){const k=T(s,t);if(k)a=k.id;else return{success:!1,message:`Worker "${t}" not found`,spoken:`I couldn't find a worker matching "${t}".`}}else if(c)a=c;else if(s.length===1)a=s[0].id;else return{success:!1,message:"Please specify which worker",spoken:"Please specify which worker to send the message to."};u(a,i+`
`);const d=s.find(k=>k.id===a);return{success:!0,message:`Sent message to ${(d==null?void 0:d.label)||"worker"}`,spoken:`Message sent to ${(d==null?void 0:d.label)||"the worker"}.`}}case"show_status":{const i=s.filter(m=>m.status==="running"),t=s.filter(m=>m.status!=="running");if(s.length===0)return{success:!0,message:"No workers",spoken:"No workers are currently registered."};const a=[];i.length>0&&a.push(`${i.length} running`),t.length>0&&a.push(`${t.length} stopped`);const d=i.map(m=>m.label||"unnamed").join(", "),k=i.length>0?`You have ${i.length} worker${i.length>1?"s":""} running: ${d}.`:"No workers are currently running.";return{success:!0,message:`Workers: ${a.join(", ")}`,spoken:k}}default:return{success:!1,message:"Unknown command",spoken:"I didn't recognize that command."}}},[s,r,l,o,u,c]),b=g.useCallback(async h=>{const j=W(h),p=await x(j);return f({type:p.success?"success":"warning",title:p.success?"Command Executed":"Command Failed",message:p.message,duration:3e3}),p},[x,f]);return{parseCommand:W,executeCommand:x,processTranscript:b,availableCommands:[{name:"spawn worker",description:"Start a new worker",example:"spawn worker on strategos"},{name:"stop worker",description:"Stop a running worker",example:"stop worker"},{name:"send message",description:"Send text to a worker",example:"send hello to the worker"},{name:"show status",description:"Show worker status",example:"show status"}]}}function q({className:s}){const{isListening:r,isSpeaking:l,transcript:o,sttSupported:u,ttsSupported:c,startListening:f,stopListening:x,clearTranscript:b,speak:h,stopSpeaking:j}=A(),{processTranscript:p,availableCommands:i}=X(),[t,a]=g.useState(!1),[d,k]=g.useState(!1),[m,I]=g.useState(!0),[N,S]=g.useState(null),[y,E]=g.useState(!1),v=g.useCallback(async()=>{if(!o.trim())return;E(!0);const n=await p(o);S(n),m&&n.spoken&&await h(n.spoken),b(),E(!1)},[o,p,m,h,b]),$=g.useCallback(()=>{l&&j(),r?(x(),v()):(b(),S(null),f())},[r,l,j,x,f,v,b]);if(g.useEffect(()=>{if(!r||!o)return;const n=setTimeout(()=>{o.trim()&&(x(),v())},2e3);return()=>clearTimeout(n)},[o,r,x,v]),g.useEffect(()=>{const n=C=>{C.ctrlKey&&C.shiftKey&&C.key==="V"&&(C.preventDefault(),$())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[$]),!u)return null;const V=()=>y?"bg-amber-500":l?"bg-blue-500":r?"bg-red-500":"bg-thea-gold/50";return e.jsxs("div",{className:w("relative",s),children:[e.jsx("div",{className:w("bg-black/80 border border-thea-gold-dark/30 backdrop-blur-sm transition-all",t?"rounded-t-lg":"rounded-lg"),children:e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsxs("button",{onClick:$,disabled:y,className:w("relative p-2.5 rounded-full transition-all",r?"bg-red-500/20 text-red-400 ring-2 ring-red-500/50 animate-pulse":l?"bg-blue-500/20 text-blue-400 ring-2 ring-blue-500/50":"bg-thea-gold/10 text-thea-gold hover:bg-thea-gold/20","disabled:opacity-50 disabled:cursor-not-allowed"),title:r?"Stop listening":"Start listening (Ctrl+Shift+V)","aria-label":r?"Stop listening":"Start voice input",children:[r?e.jsx(D,{className:"w-5 h-5"}):e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{className:w("absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full",V())})]}),e.jsx("div",{className:"flex-1 min-w-0",children:r&&o?e.jsx("p",{className:"text-sm text-thea-gold truncate animate-pulse",children:o}):r?e.jsx("p",{className:"text-sm text-red-400 animate-pulse",children:"Listening..."}):l?e.jsx("p",{className:"text-sm text-blue-400",children:"Speaking..."}):y?e.jsx("p",{className:"text-sm text-amber-400",children:"Processing..."}):N?e.jsx("p",{className:w("text-sm truncate",N.success?"text-green-400":"text-amber-400"),children:N.message}):e.jsx("p",{className:"text-xs text-thea-gold-dark/70",children:"Voice commands ready"})}),c&&e.jsx("button",{onClick:()=>I(!m),className:w("p-1.5 rounded transition-colors",m?"text-thea-gold-bright":"text-thea-gold-dark"),title:m?"Disable voice feedback":"Enable voice feedback",children:m?e.jsx(K,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k(!d),className:w("p-1.5 rounded transition-colors",d?"text-thea-gold-bright":"text-thea-gold-dark hover:text-thea-gold"),title:"Show available commands","aria-label":"Show available voice commands","aria-expanded":d,children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a(!t),className:"p-1.5 rounded text-thea-gold-dark hover:text-thea-gold transition-colors",title:t?"Collapse":"Expand","aria-label":t?"Collapse voice control":"Expand voice control","aria-expanded":t,children:t?e.jsx(R,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"})})]})}),t&&e.jsx("div",{className:"bg-black/90 border border-t-0 border-thea-gold-dark/30 rounded-b-lg p-3 backdrop-blur-sm",children:d?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-rajdhani font-semibold text-thea-gold uppercase tracking-wider",children:"Voice Commands"}),e.jsx("button",{onClick:()=>k(!1),className:"text-thea-gold-dark hover:text-thea-gold","aria-label":"Close help",children:e.jsx(O,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"space-y-1.5",children:i.map(n=>e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-thea-gold font-mono",children:n.name}),e.jsxs("span",{className:"text-thea-gold-dark/70 ml-2",children:["- ",n.description]}),e.jsxs("div",{className:"text-thea-gold-dark/50 ml-2 italic",children:['"',n.example,'"']})]},n.name))}),e.jsx("div",{className:"mt-3 pt-2 border-t border-thea-gold-dark/20",children:e.jsxs("p",{className:"text-xxs text-thea-gold-dark/50",children:["Keyboard shortcut: ",e.jsx("kbd",{className:"px-1 py-0.5 bg-black/50 rounded text-thea-gold-dark",children:"Ctrl+Shift+V"})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(L,{label:"Status",onClick:()=>{p("show status").then(n=>{S(n),m&&n.spoken&&h(n.spoken)})}}),e.jsx(L,{label:"Spawn Worker",onClick:()=>{p("spawn worker").then(n=>{S(n),m&&n.spoken&&h(n.spoken)})}}),e.jsx(L,{label:"Stop All",onClick:()=>{p("stop all workers").then(n=>{S(n),m&&n.spoken&&h(n.spoken)})},variant:"danger"})]}),N&&e.jsx("div",{className:w("p-2 rounded text-xs",N.success?"bg-green-500/10 border border-green-500/20 text-green-400":"bg-amber-500/10 border border-amber-500/20 text-amber-400"),children:N.spoken}),e.jsxs("p",{className:"text-xxs text-thea-gold-dark/50 text-center",children:["Click ",e.jsx(P,{className:"w-3 h-3 inline"})," for all commands"]})]})})]})}function L({label:s,onClick:r,variant:l="default"}){return e.jsx("button",{onClick:r,className:w("px-2 py-1 text-xs font-rajdhani font-semibold rounded border transition-colors",l==="danger"?"border-red-500/30 text-red-400 hover:bg-red-500/10":"border-thea-gold-dark/30 text-thea-gold-dark hover:text-thea-gold hover:border-thea-gold/30 hover:bg-thea-gold/5"),children:s})}export{q as VoiceControl};
